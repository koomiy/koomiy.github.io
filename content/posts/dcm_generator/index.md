---
title: "009 - 目標ZMP・DCM計画"
date: 2023-11-30
categories: ["vnoidベースの開発"]
menu: main
---

(この記事は制作途中です)

---

## 今回の内容

本チャレンジでは、初心者の方でも簡単に人形ロボットの運動計画ができるように、  
vnoidというサンプルパッケージが用意されております。

今回はvnoidパッケージの機能の一つ、  
目標ZMP・DCM計画器(footstep_planner::GenerateDCM)について解説します。

---

## 人型ロボットの運動計画法

人型ロボットはいくつものリンクからなる剛体リンク系ですが、  
一つ一つのリンクに関して運動を考えるのは非常に難しいです。

そこで、重心と ZMP を用いて人型ロボットを倒立振り子に簡単化してしまいます。  
特に、重心周りの回転運動を無視したものを線形倒立振り子といいます。  
ここで、人型ロボットの重心が線形倒立振り子運動することを、  
Linear Inverted Pendulum Mode (LIPM) で運動するといいます。

{{<figure src="./lipm.png" class="center" alt="LIPM" width="50%">}}

LIPM に従う重心と ZMP の計画をして、  
それに辻褄が合うようにベースリンクや手足のポーズを計算することで  
人型ロボットの歩行運動を計画します。

---

## ZMPとは

ZMP とは、Zero Moment Point の略語であり、  
文字通りモーメントが0になる点です。

ロボットの足裏には床からの分布反力が作用します。  
その分布力の合計を単に床反力と呼びます。  
床反力によって発生するモーメントのうち、  
鉛直軸周り以外の成分が0となる点が ZMP です。

この定義から、ZMP は足裏に作用する分布力の圧力中心  
CoP (Center of Pressure)と一致します。  
このことからも分かるように、  
ZMP は必ず支持多角形の中に存在します。  
したがって目標 ZMP を計画する際は、  
必ず支持多角形の中に入るように計画しましょう。

---

## 支持多角形とは

支持多角形とは、足裏の床面との接触点を  
ゴム紐でひっかけてできる多角形のことです。  
数学的には、ロボットと床面の接触点集合が作る凸包と定義されます。

{{<figure src="./sfp.png" class="center" alt="Support Foot Polygon" width="50%">}}

---

## DCMとは

DCM とは、Divergent Componet of Motion の略語であり、  
LIPMの重心運動の不安定成分です。  
少しイメージしづらいですが、LIPM の重心運動を  
理解するために重要な役割を果たす概念です。  
とにかくDCMは不安定な点と覚えてください。  
この DCM さえ安定化することができれば、  
LIPMの重心運動も安定化させられます。

DCMには、その点を瞬時に ZMP で踏めば自然に停止できるという性質があります。  
自然に停止するとは、十分な時間が経過したのちに  
ZMP の真上にロボットの重心が遷移するということです。  
このような状態に遷移すると着地点からの垂直床反力で重力を相殺でき、  
静的安定な状態になります。  
(この特徴から、DCMは捕まえれば安定する点として、  
Capture Point (CP) とも呼ばれます。)

また DCM には、ZMP に対して反発するように運動する性質があります。  
なおかつ重心には、DCM に安定追従するように運動する性質があります。  
よって DCM が ZMP に反発して離れすぎてしまうと、重心運動も不安定化します。  
したがって、DCM さえ安定化させてしまえばLIPMの重心運動は安定化できるのです。

これらの性質を踏まえたうえで、我々が普段何気なくやっている歩行のさなか、  
ZMP や DCM がどのように運動しているかを想像してみましょう。  
普通一歩ごとに停止しないので、一歩一歩 DCM を踏むのではなく、  
DCM の安定を保てるように ZMP が DCM を追いかけていく状態がしばらく継続します。  
そして歩くのをやめたいときに、DCM を ZMP でとらえることで安定停止します。

(ZMP,DCM,重心がどう運動するかを示すgifを貼る)

---

## なぜDCMを使うのか？

人型ロボットの運動計画変数に DCM を加える理由は次の二つです。

1. 2階常微分方程式であるLIPMの重心運動を、  
二つの1階常微分方程式に分解し、問題を簡単化できる。

1. そのうちの一つは DCM の運動方程式であり、  
これを用いることで簡単に[歩行安定化制御](hogehoge)を実装できる。

---

## サンプルコードの解説

簡単のために、片足支持中はZMPが一定であると仮定します。
この仮定の下では、ZMPとDCMの間に次の漸化式が成立します。
$$ \boldsymbol{\xi_{i+1}} = e^{\omega \tau}\boldsymbol{\xi_i} + (1 - e^{\omega \tau})\boldsymbol{p_i}	\label{analytical solution of CP} $$

---

## まとめ・次回予告

今回はvnoidパッケージの目標ZMP・DCM計画  
(footstep_planner::generateDCM) について解説しました。

次回は歩行制御(stepping_controller)について解説しようと思います。

次回： [012 - 歩行制御](https://koomiy.github.io/posts/stepping_controller/)
